---
layout: post
title: Kettle注意事項
tag:
- kettle
---

1.Spoon編輯器的啟動script(Spoon.bat/spoon.sh)下面這行最後面要加上UTF-8("-Dfile.encoding=UTF-8")，不然當ETL排程工作名稱含有中文字將無法開啟。

<div><pre><code class="bat">
if "%PENTAHO_DI_JAVA_OPTIONS%"=="" set PENTAHO_DI_JAVA_OPTIONS="-Xms1024m" "-Xmx2048m" "-XX:MaxPermSize=256m" "-Dfile.encoding=UTF-8"
</code></pre></div><br />

2.寫入資料庫發現如果文字型態欄位設非NULL時，當寫入空字串時，會被Kettle轉換成NULL而造成異常。
<div>
需在.kettle\kettle.properties 增加一行 KETTLE_EMPTY_STRING_DIFFERS_FROM_NULL=Y
讓空字串保持原狀寫入。
</div><div>※位置預設在~/.kettle/kettle.properties或在$KETTLE_HOME/.kettle/kettle.properties</div><br />

3.舊版(2008以前)MSSQL支援，需在lib目錄新增jtds-1.3.1.jar，Database Connection的Connection type需選MS SQL Server
<div>
載點 <a href="https://sourceforge.net/projects/jtds/" rel="nofollow" target="_blank">https://sourceforge.net/projects/jtds/</a>
</div><br />

4.如果MSSQL Server只支援舊版TLS，需在Database Connection的Options新增trustServerCertificate=true。
<br /><br />

5.Kettle Carte Server支援SSL，修改pwd/carte-config-master-8080.xml
<div><pre><code class="xml">
&lt;slaveserver&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;master1&lt;/name&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;hostname&gt;127.0.0.1&lt;/hostname&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;port&gt;8080&lt;/port&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;hostname&gt;(主機位址)&lt;/hostname&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;port&gt;(主機Port)&lt;/port&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;username&gt;(帳號)&lt;/username&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;password&gt;(密碼)&lt;/password&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;master&gt;Y&lt;/master&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;sslConfig&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;keyStore&gt;(JKS憑證)&lt;/keyStore&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;keyStorePassword&gt;(keyStorePassword)&lt;/keyStorePassword&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;keyPassword&gt;(keyPassword)&lt;/keyPassword&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/sslConfig&gt;<br />
&lt;/slaveserver&gt;<br />
</code></pre></div>
<br />

6.停止紀錄Kettle log，修改classes/log4j2.xml，註解以下節點即可。
<div><pre><code class="xml">
&lt;!--
&lt;RollingFile name="pdi-execution-appender" fileName="logs/pdi.log" filePattern="logs/pdi.%d{yyyy-MM-dd}.log"&gt;
    &lt;PatternLayout&gt;
        &lt;Pattern&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} %-5p &amp;lt;%t&amp;gt; %m%n&lt;/Pattern&gt;
    &lt;/PatternLayout&gt;
    &lt;Policies&gt;
        &lt;TimeBasedTriggeringPolicy /&gt;
    &lt;/Policies&gt;
    &lt;DefaultRolloverStrategy/&gt;
&lt;/RollingFile&gt;
--&gt;
</code></pre></div>
7.在/etc/profile.d新增一個&lt;設定檔名&gt;.sh檔用來設定Kettle相關系統變數
<div><pre><code class="language-bash">
export LD_LIBRARY_PATH="" #Kettle連接Oracle客戶端
export NLS_LANG="" #Kettle連接Oracle資料庫字符集
export TNS_ADMIN="" #Oracle客戶端配置文件目錄(如果有的話)
export PENTAHO_JAVA_HOME="" #Kettle用Java JRE/JDK(目前Kettle需要Java 11)
export CLASSPATH="./:$PENTAHO_JAVA_HOME/lib:$LD_LIBRARY_PATH/orai18n.jar" #Kettle引用的JDBC Jar檔
export KETTLE_HOME="" #Kettle路徑
export PATH="$PATH:$LD_LIBRARY_PATH"
</code></pre></div>
變更&lt;設定檔名&gt;.sh檔的權限並生效
<div><pre><code class="language-bash">
$ chmod +x &lt;設定檔名&gt;.sh
$ source &lt;設定檔名&gt;.sh
</code></pre></div>
8.啟動時提示缺少libwebkitgtk-1.0時，需自行安裝
<div><pre><code class="language-bash">
sudo sh -c "echo 'deb http://cz.archive.ubuntu.com/ubuntu bionic main universe' >> /etc/apt/sources.list" && \
sudo apt update -y && apt install -y libwebkitgtk-1.0-0
</code></pre></div>
參考來源：<div>【<a href="https://help.ubuntu.com/community/EnvironmentVariables" rel="nofollow" target="_blank">Ubuntu環境變數設定位置</a>】</div><div>【<a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/lacli/environment-variables-instant-client.html#GUID-BA8FB14E-1463-4F6A-9926-4F9F696E52D0" rel="nofollow" target="_blank">環境變數 - Oracle客戶端</a>】</div><div>【<a href="https://docs.oracle.com/cd/E12102_01/books/AnyInstAdm784/AnyInstAdmPreInstall18.html" rel="nofollow" target="_blank">查看Oracle資料庫字符集</a>】</div><div>【<a href="https://help.hitachivantara.com/Documentation/Pentaho/5.4/0F0/0G0/020#da089c89-c26f-4443-8613-5ae9fd6e1360__set_environment_variables" rel="nofollow" target="_blank">環境變數 - Kettle</a>】&nbsp;</div>
