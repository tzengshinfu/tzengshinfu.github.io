---
layout: post
title: 找出WebService方法用在哪些流程中
tag:
- easyflow gp
- sql
---

<pre><code class="sql">DECLARE @METHOD_NAME NVARCHAR(100) = '[要尋找的WebService方法]';<br /><br />SELECT<br /> ProcessDefinition.id,<br /> RedefinableHeader.version,<br /> ProcessDefinition.processDefinitionName,<br /> '最新版' AS STATUS<br />FROM<br /> WebApplication<br /> INNER JOIN IAppDefContainer_AppDef ON WebApplication.OID = ApplicationDefinitionOID<br /> INNER JOIN ProcessDefinition ON ProcessDefinition.OID = IAppDefContainer_AppDef.IAppDefContainerOID<br /> INNER JOIN ProcessPackage_ProcessDef ON ProcessPackage_ProcessDef.ProcessDefinitionOID = ProcessDefinition.OID<br /> INNER JOIN ProcessPackage ON ProcessPackage.OID = ProcessPackage_ProcessDef.ProcessPackageOID<br /> INNER JOIN RedefinableHeader ON RedefinableHeader.OID = ProcessPackage.redefinableHeaderOID<br />WHERE<br /> WebApplication.OID IN (<br /> SELECT<br /> OID<br /> FROM<br /> WebApplication<br /> WHERE<br /> CONCAT(id, CAST(objectVersion AS VARCHAR)) IN (<br /> SELECT<br /> CONCAT(id, CAST(MAX(objectVersion) AS VARCHAR))<br /> FROM<br /> WebApplication<br /> WHERE<br /> urlString LIKE '%' + @METHOD_NAME +'%'<br /> GROUP BY<br /> id<br /> )<br /> )<br />UNION<br />SELECT<br /> ProcessDefinition.id,<br /> RedefinableHeader.version,<br /> ProcessDefinition.processDefinitionName,<br /> '進行中' AS STATUS<br />FROM<br /> WebApplication<br /> INNER JOIN IAppDefContainer_AppDef ON WebApplication.OID = IAppDefContainer_AppDef.ApplicationDefinitionOID<br /> INNER JOIN ProcessDefinition ON ProcessDefinition.OID = IAppDefContainer_AppDef.IAppDefContainerOID<br /> INNER JOIN ProcessInstance ON ProcessInstance.processDefinitionId = ProcessDefinition.id<br /> INNER JOIN ProcessPackage_ProcessDef ON ProcessPackage_ProcessDef.ProcessDefinitionOID = ProcessDefinition.OID<br /> INNER JOIN ProcessPackage ON ProcessPackage.OID = ProcessPackage_ProcessDef.ProcessPackageOID<br /> INNER JOIN RedefinableHeader ON RedefinableHeader.OID = ProcessPackage.redefinableHeaderOID<br />WHERE<br /> urlString LIKE '%' + @METHOD_NAME +'%'<br /> AND ProcessInstance.currentState IN (0, 1, 2)<br />UNION<br />SELECT<br /> ProcessDefinition.id,<br /> RedefinableHeader.version,<br /> ProcessDefinition.processDefinitionName,<br /> '最新版' AS STATUS<br />FROM<br /> WebServicesApplication<br /> INNER JOIN IAppDefContainer_AppDef ON WebServicesApplication.OID = ApplicationDefinitionOID<br /> INNER JOIN ProcessDefinition ON ProcessDefinition.OID = IAppDefContainer_AppDef.IAppDefContainerOID<br /> INNER JOIN ProcessPackage_ProcessDef ON ProcessPackage_ProcessDef.ProcessDefinitionOID = ProcessDefinition.OID<br /> INNER JOIN ProcessPackage ON ProcessPackage.OID = ProcessPackage_ProcessDef.ProcessPackageOID<br /> INNER JOIN RedefinableHeader ON RedefinableHeader.OID = ProcessPackage.redefinableHeaderOID<br />WHERE<br /> WebServicesApplication.OID IN (<br /> SELECT<br /> OID<br /> FROM<br /> WebServicesApplication<br /> WHERE<br /> CONCAT(id, CAST(objectVersion AS VARCHAR)) IN (<br /> SELECT<br /> CONCAT(id, CAST(MAX(objectVersion) AS VARCHAR))<br /> FROM<br /> WebServicesApplication<br /> WHERE<br /> operationName = @METHOD_NAME<br /> GROUP BY<br /> id<br /> )<br /> )<br />UNION<br />SELECT<br /> ProcessDefinition.id,<br /> RedefinableHeader.version,<br /> ProcessDefinition.processDefinitionName,<br /> '進行中' AS STATUS<br />FROM<br /> WebServicesApplication<br /> INNER JOIN IAppDefContainer_AppDef ON WebServicesApplication.OID = ApplicationDefinitionOID<br /> INNER JOIN ProcessDefinition ON ProcessDefinition.OID = IAppDefContainer_AppDef.IAppDefContainerOID<br /> INNER JOIN ProcessInstance ON ProcessInstance.processDefinitionId = ProcessDefinition.id<br /> INNER JOIN ProcessPackage_ProcessDef ON ProcessPackage_ProcessDef.ProcessDefinitionOID = ProcessDefinition.OID<br /> INNER JOIN ProcessPackage ON ProcessPackage.OID = ProcessPackage_ProcessDef.ProcessPackageOID<br /> INNER JOIN RedefinableHeader ON RedefinableHeader.OID = ProcessPackage.redefinableHeaderOID<br />WHERE<br /> operationName = @METHOD_NAME<br /> AND ProcessInstance.currentState IN (0, 1, 2);</code></pre>
