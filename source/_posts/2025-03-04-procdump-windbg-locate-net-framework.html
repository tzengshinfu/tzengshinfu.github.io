---
layout: post
title: 使用ProcDump+WinDbg定位.NET Framework問題(筆記)
tag:
- ".net framework"
- procdump
- windbg
---

<p>&nbsp;1.首要條件</p><p>專案&gt;右鍵&gt;屬性&gt;建置&gt;輸出&gt;進階(D)...&gt;輸出&gt;偵錯訊息(E):&gt;僅限 Pdb</p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiEU6npr9MJ464EnqFWiynGzSV3_4y7r-2D0qoK2tmQC4iIQWQvfc0BDwKU3dajjNLoHhDUf5lD8ZCZuGR2biLACIhN0uMspIzOBb_ffiNFG1PkPnM3k3lHSt6mf58CH6_MHYQNvzWwndp5Dbvd1tb3U9GzvEjE-9wZiHmny84VgbJmfGJoy4kEVNXPheI9/s1141/image_20250303_083605.png" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="596" data-original-width="1141" height="334" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiEU6npr9MJ464EnqFWiynGzSV3_4y7r-2D0qoK2tmQC4iIQWQvfc0BDwKU3dajjNLoHhDUf5lD8ZCZuGR2biLACIhN0uMspIzOBb_ffiNFG1PkPnM3k3lHSt6mf58CH6_MHYQNvzWwndp5Dbvd1tb3U9GzvEjE-9wZiHmny84VgbJmfGJoy4kEVNXPheI9/w640-h334/image_20250303_083605.png" width="640" /></a></div><br /><p><br /></p><p><br /></p><p><br /></p><p><br /></p><p><br /></p><p><br /></p><p><br /></p><p><br /></p><p><br /></p><p><br /></p><p>參考來源：<a href="https://blog.darkthread.net/blog/about-dotnet-pdb/" rel="nofollow" target="_blank">.NET 知識高裝檢 - .pdb 檔、編譯最佳化與偵錯</a></p><p><br /></p><p>2.執行ProcDump生成記憶體傾印檔案</p><p><span style="background-color: #f3f3f3;">procdump -accepteula -ma [TargetApp.exe] [D:\target-app_dumps]</span></p><div><ul style="text-align: left;"><li data-end="214" data-start="163"><p data-end="214" data-start="165"><strong data-end="182" data-start="165"><code data-end="180" data-start="167">-accepteula</code></strong>：自動接受終端使用者授權協議（EULA），避免在執行時出現提示</p></li><li data-end="261" data-start="216"><p data-end="261" data-start="218"><strong data-end="227" data-start="218"><code data-end="225" data-start="220">-ma</code></strong>：生成完整的記憶體傾印，包括所有的記憶體內容，提供最詳細的調試資訊</p></li><li data-end="555" data-start="515"><p data-end="555" data-start="517"><strong data-end="535" data-start="517"><code data-end="533" data-start="519">TargetApp.exe</code></strong>：目標應用程式的名稱，即需要監控的程式</p></li><li data-end="597" data-start="557"><p data-end="597" data-start="559"><strong data-end="581" data-start="559"><code data-end="579" data-start="561">D:\target-app_dumps</code></strong>：指定記憶體傾印檔案的儲存路徑</p></li></ul><div><br /></div>參考來源：<a href="https://learn.microsoft.com/zh-tw/sysinternals/downloads/procdump" rel="nofollow" target="_blank">ProcDump - Sysinternals</a></div><div><br /></div><div><br /></div><div>3.執行WinDbg分析問題</div><div><br /></div><div>安裝來源<a href="https://learn.microsoft.com/zh-tw/windows-hardware/drivers/debugger/" rel="nofollow" target="_blank">安裝 Windows 調試程式</a></div><div><br /></div><div>起手式</div><blockquote style="border: none; margin: 0px 0px 0px 40px; padding: 0px; text-align: left;"><div>執行<span style="background-color: #f3f3f3;">!sym noisy</span></div></blockquote><div style="text-align: left;"><ul style="text-align: left;"><ul><li>啟用詳細符號載入</li></ul></ul></div><blockquote style="border: none; margin: 0px 0px 0px 40px; padding: 0px; text-align: left;"><div>執行<span style="background-color: #f3f3f3;">.sympath+ [Pdb路徑]</span></div></blockquote><div style="text-align: left;"><ul style="text-align: left;"><ul><li>設定符號搜尋路徑</li></ul></ul></div><blockquote style="border: none; margin: 0px 0px 0px 40px; padding: 0px; text-align: left;"><div>執行<span style="background-color: #f3f3f3;">.reload</span></div><div>執行<span style="background-color: #f3f3f3;">ld*</span></div></blockquote><div style="text-align: left;"><ul style="text-align: left;"><ul><li>強制載入符號</li></ul></ul></div><blockquote style="border: none; margin: 0px 0px 0px 40px; padding: 0px; text-align: left;"><div>執行<span style="background-color: #f3f3f3;">.loadby sos clr</span></div></blockquote><div style="text-align: left;"><ul style="text-align: left;"><ul><li>載入.NET類別資訊偵錯用</li></ul></ul></div><blockquote style="border: none; margin: 0px 0px 0px 40px; padding: 0px; text-align: left;"><div>執行<span style="background-color: #f3f3f3;">.chain</span></div></blockquote><div style="text-align: left;"><ul style="text-align: left;"><ul><li>檢查載入是否成功</li></ul></ul></div><div>再依問題類型下對應指令查詢</div><div><br /></div><div>參考來源：<a href="https://github.com/ctripxchuang/dotnetfly" rel="nofollow" target="_blank">真实案例大全</a></div>
