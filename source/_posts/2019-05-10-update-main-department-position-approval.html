---
layout: post
title: 更新主部門,職務,核決層級,職稱
tag:
- easyflow gp
- sql
---

<pre><code class="sql"> DECLARE @userId nvarchar(100) <br /> DECLARE @newOrganizationUnitId nvarchar(100) <br /> DECLARE @newFunctionDefinitionName nvarchar(100) <br /> DECLARE @newFunctionLevelName nvarchar(100) <br /> DECLARE @occupantOID char(32) <br /> DECLARE @newOrganizationOID char(32) <br /> DECLARE @newOrganizationUnitOID char(32) <br /> DECLARE @newFunctionsDefinitionOID char(32) <br /> DECLARE @newApprovalLevelOID char(32) <br /> DECLARE @newTitleDefinitionOID char(32) <br /> <br /> SET @userId = '[工號]' <br /> SET @newOrganizationUnitId = '[部門代號]' <br /> SET @newFunctionDefinitionName = '[職務名稱]' <br /> SET @newFunctionLevelName = '[核決權限名稱]' <br /> SET @occupantOID = (SELECT OID FROM Users WHERE id = @userId) <br /> SET @newOrganizationOID = (select organizationOID FROM OrganizationUnit WHERE id = @newOrganizationUnitId) <br /> SET @newOrganizationUnitOID = (SELECT OID FROM OrganizationUnit WHERE id = @newOrganizationUnitId) <br /> SET @newFunctionsDefinitionOID = (SELECT OID FROM FunctionDefinition WHERE organizationOID = @newOrganizationOID AND functionDefinitionName = @newFunctionDefinitionName) <br /> SET @newApprovalLevelOID = (SELECT OID FROM FunctionLevel WHERE organizationOID = @newOrganizationOID AND functionLevelName = @newFunctionLevelName) <br /> SET @newTitleDefinitionOID = (SELECT OID FROM TitleDefinition WHERE organizationOID = @newOrganizationOID AND titleDefinitionName = @newFunctionDefinitionName) <br /> <br /> /*更新主部門*/ <br /> UPDATE Functions <br /> SET organizationUnitOID = @newOrganizationUnitOID<br /> ,objectVersion = objectVersion + 1 <br /> WHERE isMain = 1 AND occupantOID = @occupantOID <br /> <br /> /*更新職務*/ <br /> UPDATE Functions <br /> SET definitionOID = @newFunctionsDefinitionOID<br /> ,objectVersion = objectVersion + 1 <br /> WHERE isMain = 1 AND occupantOID = @occupantOID <br /> <br /> /*更新核決層級*/ <br /> UPDATE Functions <br /> SET approvalLevelOID = @newApprovalLevelOID<br /> ,objectVersion = objectVersion + 1 <br /> WHERE isMain = 1 AND occupantOID = @occupantOID <br /> <br /> /*更新職稱*/ <br /> UPDATE Title <br /> SET definitionOID = @newTitleDefinitionOID<br /> ,objectVersion = objectVersion + 1 <br /> WHERE organizationUnitOID = @newOrganizationUnitOID AND occupantOID = @occupantOID</code></pre>
