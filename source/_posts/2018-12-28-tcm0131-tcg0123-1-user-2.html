---
layout: post
title: 發單時選錯部門導致跑到錯誤的直屬主管之解決方法
tag:
- easyflow gp
---

場景: <br /> 發單者有主(=TCM0131)部門及其他(=TCG0123)部門, 兩個部門直屬主管為不同人。 <br /> 流程其中有關卡為發單者直屬主管。 <br /> <a href="https://www.blogger.com/#"><img border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiOzutl2TT6fttqPrZ3MxusOaNHGbn-KFS_K_9E4XvbVz3fS2L11nNJ04dkfqj__jJ2K5BKHfxiTJg1yPDGGPISTpE1y2yWrwYcfZtyEQlQTG1qL2_wMXRdObT2SzmYuqoZxxWaGQc_RWcm/s640/0_0_image002.png" /></a> <br /><a href="https://www.blogger.com/#"><br /></a><a href="https://www.blogger.com/#"><br /></a><a href="https://www.blogger.com/#"><img border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjhSDCYeIwOvwuhNJ7tifGA_yXYN5v4WFUUPM5gSpKKCjZ55fH0V0542UK3kPyn_uyV2V5G2qWN9l69cQH7y8Wc9fpsMZnDC2yvPaeboTdNeoy0DOkFF7vFTrrWhHA4KPxqsYzhowMVzM30/s400/0_0_image003.png" /></a> <br /> <br /><br /> 發單時選錯部門。 <br /><br /> <br /> 被退回重辦, 但發單者再次派送, 系統卻不會再詢問要用哪個單位進行派送導致又送錯主管。 <br />此時可以 <br /> 1.      請User終止原流程, 重新發單。 <br /> 或 <br /> 2.      修正EasyFlow參考及發單部門欄位。 <br /> <br /> 動作: <br /> (1)   先退回發單者關卡。 <br /> (2)   修改DB:EFGP的Table:ProcessInstance流程資料, 把發單部門及參考部門都改為正確的部門。 <br /><br /> SQL語法: <br /><pre><code class="sql">     DECLARE @UNIT_OID char(32) = (SELECT OID FROM OrganizationUnit WHERE id = '&lt;正確部門代號&gt;'); <br /> <br />       UPDATE ProcessInstance <br />       SET referOrganizationUnitOID = @UNIT_OID, /**改這個欄位, 流程引擎在派送到下一關卡時會依照這個欄位判斷流向。*/&nbsp;<br />       invokeOrganizationUnitOID = @UNIT_OID<br /> ,objectVersion = objectVersion + 1 <br />       WHERE serialNumber = &lt;流程序號&gt;;</code></pre> <br /> <br /> (3)   重新派送, 發現已可到正確的直屬主管。 <br /> <a href="https://www.blogger.com/#"><img border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhruZChiVbTik4CufuYhfDMm7uvjdeINvSyjkjKFnMI6szWvw45A-K-muDKMsYMTx1XryWDKpdgBNCo4iQbuGRTv0L7ywLuLZ9ct6nNRFr2SZcwwU5Xadzsy_vbKoZ3DBkBQ40MWnuL8Sjb/s400/0_0_image004.png" /></a> <br /> <br />
